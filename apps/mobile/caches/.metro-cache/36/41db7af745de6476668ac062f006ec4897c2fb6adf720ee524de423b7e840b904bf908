{"dependencies":[{"name":"./notifyManager.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":24},"end":{"line":2,"column":51,"index":75}}],"key":"sE8Jk2BSATSKXEwal1fu77sfV3E=","exportNames":["*"]}},{"name":"./mutation.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":76},"end":{"line":3,"column":41,"index":117}}],"key":"DEeb5DG8JiSOn+k43YR2tCf/fEk=","exportNames":["*"]}},{"name":"./utils.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":118},"end":{"line":4,"column":49,"index":167}}],"key":"NIaSEHO1E48gsZc7jH9Ex1xTHgE=","exportNames":["*"]}},{"name":"./subscribable.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":168},"end":{"line":5,"column":49,"index":217}}],"key":"f0fxTGZggQRtb//cHMvH9AHIWOw=","exportNames":["*"]}}],"output":[{"data":{"code":"__d(function(g,r,i,a,_m,e,d){Object.defineProperty(e,\"__esModule\",{value:!0}),e.MutationCache=void 0;var t=r(d[0]),s=r(d[1]),n=r(d[2]),o=r(d[3]),c=class extends o.Subscribable{constructor(t={}){super(),this.config=t,this.#t=new Set,this.#e=new Map,this.#s=0}#t;#e;#s;build(t,n,o){const c=new s.Mutation({mutationCache:this,mutationId:++this.#s,options:t.defaultMutationOptions(n),state:o});return this.add(c),c}add(t){this.#t.add(t);const s=u(t);if(\"string\"==typeof s){const n=this.#e.get(s);n?n.push(t):this.#e.set(s,[t])}this.notify({type:\"added\",mutation:t})}remove(t){if(this.#t.delete(t)){const s=u(t);if(\"string\"==typeof s){const n=this.#e.get(s);if(n)if(n.length>1){const s=n.indexOf(t);-1!==s&&n.splice(s,1)}else n[0]===t&&this.#e.delete(s)}}this.notify({type:\"removed\",mutation:t})}canRun(t){const s=u(t);if(\"string\"==typeof s){const n=this.#e.get(s),o=n?.find(t=>\"pending\"===t.state.status);return!o||o===t}return!0}runNext(t){const s=u(t);if(\"string\"==typeof s){const n=this.#e.get(s)?.find(s=>s!==t&&s.state.isPaused);return n?.continue()??Promise.resolve()}return Promise.resolve()}clear(){t.notifyManager.batch(()=>{this.#t.forEach(t=>{this.notify({type:\"removed\",mutation:t})}),this.#t.clear(),this.#e.clear()})}getAll(){return Array.from(this.#t)}find(t){const s=Object.assign({exact:!0},t);return this.getAll().find(t=>(0,n.matchMutation)(s,t))}findAll(t={}){return this.getAll().filter(s=>(0,n.matchMutation)(t,s))}notify(s){t.notifyManager.batch(()=>{this.listeners.forEach(t=>{t(s)})})}resumePausedMutations(){const s=this.getAll().filter(t=>t.state.isPaused);return t.notifyManager.batch(()=>Promise.all(s.map(t=>t.continue().catch(n.noop))))}};function u(t){return t.options.scope?.id}e.MutationCache=c});","lineCount":1,"map":[[1,101,2,0],[1,105,2,0,"_notifyManager"],[1,107,2,0,"r"],[1,109,2,0,"d"],[1,111,2,0],[1,115,3,0,"_mutation"],[1,117,3,0,"r"],[1,119,3,0,"d"],[1,121,3,0],[1,125,4,0,"_utils"],[1,127,4,0,"r"],[1,129,4,0,"d"],[1,131,4,0],[1,135,5,0,"_subscribable"],[1,137,5,0,"r"],[1,139,5,0,"d"],[1,141,5,0],[1,145,6,4,"MutationCache"],[1,147,6,20],[1,161,6,34,"Subscribable"],[1,176,7,2,"constructor"],[1,188,7,14,"config"],[1,190,7,23],[1,191,7,24],[1,194,8,4,"super"],[1,202,9,4,"this"],[1,207,9,9,"config"],[1,214,9,18,"config"],[1,216,10,4,"this"],[1,222,10,9,"mutations"],[1,224,10,38],[1,228,10,42,"Set"],[1,232,11,4,"this"],[1,238,11,9,"scopes"],[1,240,11,35],[1,244,11,39,"Map"],[1,248,12,4,"this"],[1,254,12,9,"mutationId"],[1,256,12,23],[1,257,13,2],[1,258,14,2,"mutations"],[1,261,15,2,"scopes"],[1,264,16,2,"mutationId"],[1,267,17,2,"build"],[1,273,17,8,"client"],[1,275,17,16,"options"],[1,277,17,25,"state"],[1,280,18,4],[1,286,18,10,"mutation"],[1,288,18,21],[1,292,18,25,"Mutation"],[1,303,18,34],[1,304,19,6,"mutationCache"],[1,318,19,21,"this"],[1,323,20,6,"mutationId"],[1,336,20,20,"this"],[1,342,20,25,"mutationId"],[1,344,21,6,"options"],[1,352,21,15,"client"],[1,354,21,22,"defaultMutationOptions"],[1,377,21,45,"options"],[1,380,22,6,"state"],[1,390,25,4],[1,397,24,4,"this"],[1,402,24,9,"add"],[1,406,24,13,"mutation"],[1,409,25,11,"mutation"],[1,410,26,2],[1,411,27,2,"add"],[1,415,27,6,"mutation"],[1,418,28,4,"this"],[1,424,28,9,"mutations"],[1,426,28,20,"add"],[1,430,28,24,"mutation"],[1,433,29,4],[1,439,29,10,"scope"],[1,441,29,18,"scopeFor"],[1,443,29,27,"mutation"],[1,446,30,4],[1,449,30,25],[1,466,30,15,"scope"],[1,468,30,35],[1,469,31,6],[1,475,31,12,"scopedMutations"],[1,477,31,30,"this"],[1,483,31,35,"scopes"],[1,485,31,43,"get"],[1,489,31,47,"scope"],[1,492,32,10,"scopedMutations"],[1,494,33,8,"scopedMutations"],[1,496,33,24,"push"],[1,501,33,29,"mutation"],[1,504,35,8,"this"],[1,510,35,13,"scopes"],[1,512,35,21,"set"],[1,516,35,25,"scope"],[1,518,35,32],[1,519,35,33,"mutation"],[1,522,37,4],[1,523,38,4,"this"],[1,528,38,9,"notify"],[1,535,38,16],[1,536,38,18,"type"],[1,541,38,24],[1,549,38,33,"mutation"],[1,561,39,2],[1,562,40,2,"remove"],[1,569,40,9,"mutation"],[1,572,41,4],[1,575,41,8,"this"],[1,581,41,13,"mutations"],[1,583,41,24,"delete"],[1,590,41,31,"mutation"],[1,593,41,42],[1,594,42,6],[1,600,42,12,"scope"],[1,602,42,20,"scopeFor"],[1,604,42,29,"mutation"],[1,607,43,6],[1,610,43,27],[1,627,43,17,"scope"],[1,629,43,37],[1,630,44,8],[1,636,44,14,"scopedMutations"],[1,638,44,32,"this"],[1,644,44,37,"scopes"],[1,646,44,45,"get"],[1,650,44,49,"scope"],[1,653,45,8],[1,656,45,12,"scopedMutations"],[1,658,46,10],[1,661,46,14,"scopedMutations"],[1,663,46,30,"length"],[1,670,46,39],[1,672,46,42],[1,673,47,12],[1,679,47,18,"index"],[1,681,47,26,"scopedMutations"],[1,683,47,42,"indexOf"],[1,691,47,50,"mutation"],[1,695,48,21],[1,699,48,16,"index"],[1,702,49,14,"scopedMutations"],[1,704,49,30,"splice"],[1,711,49,37,"index"],[1,713,49,44],[1,715,51,10],[1,721,51,21,"scopedMutations"],[1,723,51,37],[1,728,51,44,"mutation"],[1,731,52,12,"this"],[1,737,52,17,"scopes"],[1,739,52,25,"delete"],[1,746,52,32,"scope"],[1,748,55,6],[1,749,56,4],[1,750,57,4,"this"],[1,755,57,9,"notify"],[1,762,57,16],[1,763,57,18,"type"],[1,768,57,24],[1,778,57,35,"mutation"],[1,790,58,2],[1,791,59,2,"canRun"],[1,798,59,9,"mutation"],[1,801,60,4],[1,807,60,10,"scope"],[1,809,60,18,"scopeFor"],[1,811,60,27,"mutation"],[1,814,61,4],[1,817,61,25],[1,834,61,15,"scope"],[1,836,61,35],[1,837,62,6],[1,843,62,12,"mutationsWithSameScope"],[1,845,62,37,"this"],[1,851,62,42,"scopes"],[1,853,62,50,"get"],[1,857,62,54,"scope"],[1,860,63,12,"firstPendingMutation"],[1,862,63,35,"mutationsWithSameScope"],[1,865,63,59,"find"],[1,870,64,9,"m"],[1,873,64,34],[1,885,64,15,"m"],[1,887,64,17,"state"],[1,893,64,23,"status"],[1,901,66,6],[1,908,66,14,"firstPendingMutation"],[1,911,66,38,"firstPendingMutation"],[1,915,66,63,"mutation"],[1,916,67,4],[1,917,68,6],[1,924,68,13],[1,925,70,2],[1,926,71,2,"runNext"],[1,934,71,10,"mutation"],[1,937,72,4],[1,943,72,10,"scope"],[1,945,72,18,"scopeFor"],[1,947,72,27,"mutation"],[1,950,73,4],[1,953,73,25],[1,970,73,15,"scope"],[1,972,73,35],[1,973,74,6],[1,979,74,12,"foundMutation"],[1,981,74,28,"this"],[1,987,74,33,"scopes"],[1,989,74,41,"get"],[1,993,74,45,"scope"],[1,997,74,53,"find"],[1,1002,74,59,"m"],[1,1005,74,65,"m"],[1,1009,74,71,"mutation"],[1,1012,74,83,"m"],[1,1014,74,85,"state"],[1,1020,74,91,"isPaused"],[1,1030,75,6],[1,1037,75,13,"foundMutation"],[1,1040,75,28,"continue"],[1,1052,75,42,"Promise"],[1,1060,75,50,"resolve"],[1,1069,76,4],[1,1070,77,6],[1,1077,77,13,"Promise"],[1,1085,77,21,"resolve"],[1,1094,79,2],[1,1095,80,2,"clear"],[1,1103,81,4,"notifyManager"],[1,1119,81,18,"batch"],[1,1125,81,24],[1,1130,82,6,"this"],[1,1136,82,11,"mutations"],[1,1138,82,22,"forEach"],[1,1146,82,31,"mutation"],[1,1150,83,8,"this"],[1,1155,83,13,"notify"],[1,1162,83,20],[1,1163,83,22,"type"],[1,1168,83,28],[1,1178,83,39,"mutation"],[1,1193,85,6,"this"],[1,1199,85,11,"mutations"],[1,1201,85,22,"clear"],[1,1209,86,6,"this"],[1,1215,86,11,"scopes"],[1,1217,86,19,"clear"],[1,1226,88,2],[1,1227,89,2,"getAll"],[1,1236,90,4],[1,1243,90,11,"Array"],[1,1249,90,17,"from"],[1,1254,90,22,"this"],[1,1260,90,27,"mutations"],[1,1262,91,2],[1,1263,92,2,"find"],[1,1268,92,7,"filters"],[1,1271,93,4],[1,1277,93,10,"defaultedFilters"],[1,1279,93,26,"Object"],[1,1286,93,26,"assign"],[1,1293,93,26],[1,1294,93,31,"exact"],[1,1301,93,38],[1,1304,93,47,"filters"],[1,1307,94,4],[1,1314,94,11,"this"],[1,1319,94,16,"getAll"],[1,1328,94,25,"find"],[1,1333,95,7,"mutation"],[1,1337,95,20],[1,1339,95,20,"matchMutation"],[1,1356,95,34,"defaultedFilters"],[1,1358,95,52,"mutation"],[1,1361,97,2],[1,1362,98,2,"findAll"],[1,1370,98,10,"filters"],[1,1372,98,20],[1,1373,98,21],[1,1376,99,4],[1,1383,99,11,"this"],[1,1388,99,16,"getAll"],[1,1397,99,25,"filter"],[1,1404,99,33,"mutation"],[1,1408,99,46],[1,1410,99,46,"matchMutation"],[1,1427,99,60,"filters"],[1,1429,99,69,"mutation"],[1,1432,100,2],[1,1433,101,2,"notify"],[1,1440,101,9,"event"],[1,1443,102,4,"notifyManager"],[1,1459,102,18,"batch"],[1,1465,102,24],[1,1470,103,6,"this"],[1,1475,103,11,"listeners"],[1,1485,103,21,"forEach"],[1,1493,103,30,"listener"],[1,1497,104,8,"listener"],[1,1499,104,17,"event"],[1,1505,107,2],[1,1506,108,2,"resumePausedMutations"],[1,1530,109,4],[1,1536,109,10,"pausedMutations"],[1,1538,109,28,"this"],[1,1543,109,33,"getAll"],[1,1552,109,42,"filter"],[1,1559,109,50,"x"],[1,1562,109,56,"x"],[1,1564,109,58,"state"],[1,1570,109,64,"isPaused"],[1,1580,110,4],[1,1587,110,11,"notifyManager"],[1,1603,110,25,"batch"],[1,1609,111,6],[1,1613,111,12,"Promise"],[1,1621,111,20,"all"],[1,1625,112,8,"pausedMutations"],[1,1627,112,24,"map"],[1,1631,112,29,"mutation"],[1,1634,112,42,"mutation"],[1,1636,112,51,"continue"],[1,1647,112,62,"catch"],[1,1653,112,68,"noop"],[1,1663,115,2],[1,1666,117,0],[1,1675,117,9,"scopeFor"],[1,1677,117,18,"mutation"],[1,1680,118,2],[1,1687,118,9,"mutation"],[1,1689,118,18,"options"],[1,1697,118,26,"scope"],[1,1704,118,33,"id"],[1,1706,119,0],[1,1707,116,2,"e"],[1,1709,116,2,"MutationCache"],[1,1724,119,1],[1,1727]],"functionMap":{"names":["<global>","MutationCache","MutationCache#constructor","MutationCache#build","MutationCache#add","MutationCache#remove","MutationCache#canRun","mutationsWithSameScope.find$argument_0","MutationCache#runNext","get.find$argument_0","MutationCache#clear","notifyManager.batch$argument_0","forEach$argument_0","MutationCache#getAll","MutationCache#find","getAll.find$argument_0","MutationCache#findAll","getAll.filter$argument_0","MutationCache#notify","listeners.forEach$argument_0","MutationCache#resumePausedMutations","pausedMutations.map$argument_0","scopeFor"],"mappings":"AAA;oBCK;ECC;GDM;EEI;GFS;EGC;GHY;EIC;GJkB;EKC;QCK,mCD;GLM;EOC;0DCG,yCD;GPK;ESC;wBCC;8BCC;ODE;KDG;GTC;EYC;GZE;EaC;MCG,uDD;GbE;EeC;gCCC,8CD;GfC;EiBC;wBPC;6BQC;ORE;KOC;GjBC;EmBC;iDHC,uBG;MTE;4BUC,6CV;OSC;GnBE;CDC;AsBC;CtBE"}},"type":"js/module"}]}